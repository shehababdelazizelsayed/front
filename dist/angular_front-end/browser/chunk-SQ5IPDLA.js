import{A as v,B as f,C as c,G as r,I as g,K as I,L as h,M as b,S as w,U as C,Z as V,_ as k,ba as E,j as l,k as m,ka as T,la as M,na as P,r as d,s as p,sa as O,t as y,v as _,w as u,x as n,y as t,z as S}from"./chunk-675GNN7X.js";function A(i,a){i&1&&(n(0,"div",5)(1,"h2"),r(2,"Verifying your payment\u2026"),t(),S(3,"div",6),t())}function N(i,a){if(i&1&&(n(0,"p")(1,"strong"),r(2,"Order ID:"),t(),r(3),t()),i&2){let e=c(3);d(3),g(" ",e.orderId)}}function H(i,a){if(i&1&&(n(0,"p")(1,"strong"),r(2,"Amount:"),t(),r(3),t()),i&2){let e=c(3);d(3),g(" $",e.amount)}}function D(i,a){if(i&1&&(n(0,"div",14),_(1,N,4,1,"p",15)(2,H,4,1,"p",15),t()),i&2){let e=c(2);d(),u("ngIf",e.orderId),d(),u("ngIf",e.amount)}}function j(i,a){if(i&1){let e=v();n(0,"div",7)(1,"h1",8),r(2,"\u2705 Payment Successful!"),t(),n(3,"p",9),r(4,"Thank you \u2014 your order was placed successfully."),t(),_(5,D,3,2,"div",10),n(6,"div",11)(7,"button",12),f("click",function(){l(e);let s=c();return m(s.goHome())}),r(8,"Continue Shopping"),t(),n(9,"button",13),f("click",function(){l(e);let s=c();return m(s.goToOrders())}),r(10,"View Orders"),t()()()}if(i&2){let e=c();d(5),u("ngIf",e.orderId||e.amount)}}function W(i,a){if(i&1){let e=v();n(0,"div",16)(1,"h2"),r(2,"No session id found"),t(),n(3,"p"),r(4," If you were redirected from the payment provider but the session id is missing from the URL, paste the session id below (often labeled "),n(5,"code"),r(6,"session_id"),t(),r(7,") and click Verify. "),t(),n(8,"div",17)(9,"input",18),b("ngModelChange",function(s){l(e);let x=c();return h(x.manualSessionId,s)||(x.manualSessionId=s),m(s)}),t(),n(10,"button",19),f("click",function(){l(e);let s=c();return m(s.verifyPayment(s.manualSessionId))}),r(11," Verify "),t()(),n(12,"div",20)(13,"button",13),f("click",function(){l(e);let s=c();return m(s.goHome())}),r(14,"Back to Home"),t(),n(15,"button",21),f("click",function(){l(e);let s=c();return m(s.goToOrders())}),r(16,"Check Orders"),t()()()}if(i&2){let e=c();d(9),I("ngModel",e.manualSessionId),d(),u("disabled",!e.manualSessionId.trim())}}function B(i,a){if(i&1){let e=v();n(0,"div",22)(1,"h1",23),r(2,"\u274C Payment Not Verified"),t(),n(3,"p",9),r(4," We couldn't confirm the payment. If you were charged, please contact support and provide your payment reference. "),t(),n(5,"div",11)(6,"button",13),f("click",function(){l(e);let s=c();return m(s.goHome())}),r(7,"Back to Home"),t(),n(8,"button",21),f("click",function(){l(e);let s=c();return m(s.goToOrders())}),r(9,"Check Orders"),t()()()}}var R=class i{constructor(a,e,o){this.route=a;this.router=e;this.api=o}sessionId=null;verifying=!0;verified=!1;failed=!1;orderId;amount;manualSessionId="";ngOnInit(){if(this.sessionId=this.route.snapshot.queryParamMap.get("session_id"),this.sessionId||(this.sessionId=localStorage.getItem("stripe_session_id")),!this.sessionId)try{let a=this.router.getCurrentNavigation?.(),e=a?.extras?.state?.sessionId||a?.extras?.state?.session_id;e&&(this.sessionId=e)}catch{}if(!this.sessionId){this.verifying=!1,this.failed=!1;return}this.verifyPayment(this.sessionId)}verifyPayment(a){this.verifying=!0,this.api.verifyPaymentSession(a).subscribe({next:e=>{e&&e.success?(this.verified=!0,this.orderId=e.orderId||e.order?._id,this.amount=e.amount||e.order?.amount||e.total,localStorage.removeItem("stripe_session_id")):this.failed=!0},error:e=>{this.failed=!0},complete:()=>{this.verifying=!1}})}goHome(){this.router.navigate(["/home"])}goToOrders(){this.router.navigate(["/profile"])}static \u0275fac=function(e){return new(e||i)(p(M),p(P),p(O))};static \u0275cmp=y({type:i,selectors:[["app-success"]],decls:5,vars:4,consts:[[1,"success-page"],["class","verifying",4,"ngIf"],["class","verified",4,"ngIf"],["class","manual-verify",4,"ngIf"],["class","failed",4,"ngIf"],[1,"verifying"],[1,"spinner"],[1,"verified"],[1,"title"],[1,"subtitle"],["class","order-meta",4,"ngIf"],[1,"actions"],[1,"btn","primary",3,"click"],[1,"btn","secondary",3,"click"],[1,"order-meta"],[4,"ngIf"],[1,"manual-verify"],[1,"manual-input",2,"margin-top","1rem","display","flex","gap","0.5rem","align-items","center","justify-content","center"],["placeholder","paste session id here",2,"min-width","320px","padding","0.5rem","border-radius","6px","border","1px solid #444","background","#111","color","#fff",3,"ngModelChange","ngModel"],[1,"btn","primary",3,"click","disabled"],[2,"margin-top","1rem","text-align","center"],[1,"btn",3,"click"],[1,"failed"],[1,"title","error"]],template:function(e,o){e&1&&(n(0,"div",0),_(1,A,4,0,"div",1)(2,j,11,1,"div",2)(3,W,17,2,"div",3)(4,B,10,0,"div",4),t()),e&2&&(d(),u("ngIf",o.verifying),d(),u("ngIf",o.verified&&!o.verifying),d(),u("ngIf",!o.sessionId&&!o.verifying&&!o.verified),d(),u("ngIf",o.failed&&!o.verifying))},dependencies:[C,w,T,V,k,E],encapsulation:2})};export{R as Success};
