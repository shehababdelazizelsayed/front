import{A as g,B as f,C as a,G as r,I as v,K as C,L as h,M as S,S as I,U as M,Z as P,_ as O,ba as w,j as l,k as m,ka as k,la as V,na as E,r as d,s as p,sa as T,t as y,v as _,w as u,x as n,y as t,z as b}from"./chunk-XLSXSMKF.js";function A(i,c){i&1&&(n(0,"div",5)(1,"h2"),r(2,"Verifying your payment\u2026"),t(),b(3,"div",6),t())}function N(i,c){if(i&1&&(n(0,"p")(1,"strong"),r(2,"Order ID:"),t(),r(3),t()),i&2){let e=a(3);d(3),v(" ",e.orderId)}}function H(i,c){if(i&1&&(n(0,"p")(1,"strong"),r(2,"Amount:"),t(),r(3),t()),i&2){let e=a(3);d(3),v(" $",e.amount)}}function j(i,c){if(i&1&&(n(0,"div",14),_(1,N,4,1,"p",15)(2,H,4,1,"p",15),t()),i&2){let e=a(2);d(),u("ngIf",e.orderId),d(),u("ngIf",e.amount)}}function D(i,c){if(i&1){let e=g();n(0,"div",7)(1,"h1",8),r(2,"\u2705 Payment Successful!"),t(),n(3,"p",9),r(4,"Thank you \u2014 your order was placed successfully."),t(),_(5,j,3,2,"div",10),n(6,"div",11)(7,"button",12),f("click",function(){l(e);let o=a();return m(o.goHome())}),r(8,"Continue Shopping"),t(),n(9,"button",13),f("click",function(){l(e);let o=a();return m(o.goToOrders())}),r(10,"View Orders"),t()()()}if(i&2){let e=a();d(5),u("ngIf",e.orderId||e.amount)}}function W(i,c){if(i&1){let e=g();n(0,"div",16)(1,"h2"),r(2,"No session id found"),t(),n(3,"p"),r(4," If you were redirected from the payment provider but the session id is missing from the URL, paste the session id below (often labeled "),n(5,"code"),r(6,"session_id"),t(),r(7,") and click Verify. "),t(),n(8,"div",17)(9,"input",18),S("ngModelChange",function(o){l(e);let x=a();return h(x.manualSessionId,o)||(x.manualSessionId=o),m(o)}),t(),n(10,"button",19),f("click",function(){l(e);let o=a();return m(o.verifyPayment(o.manualSessionId))}),r(11," Verify "),t()(),n(12,"div",20)(13,"button",13),f("click",function(){l(e);let o=a();return m(o.goHome())}),r(14,"Back to Home"),t(),n(15,"button",21),f("click",function(){l(e);let o=a();return m(o.goToOrders())}),r(16,"Check Orders"),t()()()}if(i&2){let e=a();d(9),C("ngModel",e.manualSessionId),d(),u("disabled",!e.manualSessionId.trim())}}function B(i,c){if(i&1){let e=g();n(0,"div",22)(1,"h1",23),r(2,"\u274C Payment Not Verified"),t(),n(3,"p",9),r(4," We couldn't confirm the payment. If you were charged, please contact support and provide your payment reference. "),t(),n(5,"div",11)(6,"button",13),f("click",function(){l(e);let o=a();return m(o.goHome())}),r(7,"Back to Home"),t(),n(8,"button",12),f("click",function(){l(e);let o=a();return m(o.goToOrders())}),r(9,"Check Orders"),t()()()}}var z=".success-page[_ngcontent-%COMP%]{max-width:600px;margin:8rem auto;padding:2rem;background:#1a1a1a;border-radius:12px;box-shadow:0 8px 24px #0009;color:#fff;font-family:Inter,sans-serif;text-align:center}.verifying[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{margin:1.5rem auto;width:48px;height:48px;border:4px solid #444;border-top:4px solid #00e676;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.verifying[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;margin-bottom:1rem;color:#00e676}.verified[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:2rem;color:#00e676;margin-bottom:.5rem}.verified[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:1.2rem;color:#ccc;margin-bottom:1.5rem}.order-meta[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;margin:.3rem 0;color:#ddd}.failed[_ngcontent-%COMP%]   .title.error[_ngcontent-%COMP%]{font-size:2rem;color:#ff5252;margin-bottom:.5rem}.failed[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:1.2rem;color:#ccc;margin-bottom:1.5rem}.actions[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:1rem;margin-top:1.5rem}.btn[_ngcontent-%COMP%]{padding:.6rem 1.2rem;font-size:1rem;border-radius:6px;border:none;cursor:pointer;transition:all .2s ease-in-out;font-weight:600}.btn.primary[_ngcontent-%COMP%]{background-color:#00e676;color:#fff}.btn.primary[_ngcontent-%COMP%]:hover{background-color:#00c853}.btn.secondary[_ngcontent-%COMP%]{background-color:#444;color:#fff}.btn.secondary[_ngcontent-%COMP%]:hover{background-color:#666}.manual-verify[_ngcontent-%COMP%]{margin-top:1.5rem;text-align:center}.manual-verify[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.5rem}.manual-verify[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.95rem;color:#ccc;margin-bottom:1rem}.manual-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:#111;border:1px solid #555;color:#fff;border-radius:6px;padding:.5rem;font-size:1rem;width:100%;max-width:400px}.manual-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}.manual-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}",R=class i{constructor(c,e,s){this.route=c;this.router=e;this.api=s}sessionId=null;verifying=!0;verified=!1;failed=!1;orderId;amount;manualSessionId="";ngOnInit(){if(this.sessionId=this.route.snapshot.queryParamMap.get("session_id"),this.sessionId||(this.sessionId=localStorage.getItem("stripe_session_id")),!this.sessionId)try{let c=this.router.getCurrentNavigation?.(),e=c?.extras?.state?.sessionId||c?.extras?.state?.session_id;e&&(this.sessionId=e)}catch{}if(!this.sessionId){this.verifying=!1,this.failed=!1;return}this.verifyPayment(this.sessionId)}verifyPayment(c){this.verifying=!0,this.api.verifyPaymentSession(c).subscribe({next:e=>{e&&e.success?(this.verified=!0,this.orderId=e.orderId||e.order?._id,this.amount=e.amount||e.order?.amount||e.total,localStorage.removeItem("stripe_session_id")):this.failed=!0},error:e=>{this.failed=!0},complete:()=>{this.verifying=!1}})}goHome(){this.router.navigate(["/home"])}goToOrders(){this.router.navigate(["/profile"])}static \u0275fac=function(e){return new(e||i)(p(V),p(E),p(T))};static \u0275cmp=y({type:i,selectors:[["app-success"]],decls:5,vars:4,consts:[[1,"success-page","pt-5"],["class","verifying",4,"ngIf"],["class","verified",4,"ngIf"],["class","manual-verify",4,"ngIf"],["class","failed",4,"ngIf"],[1,"verifying"],[1,"spinner"],[1,"verified"],[1,"title"],[1,"subtitle"],["class","order-meta",4,"ngIf"],[1,"actions"],[1,"btn","primary",3,"click"],[1,"btn","secondary",3,"click"],[1,"order-meta"],[4,"ngIf"],[1,"manual-verify"],[1,"manual-input",2,"margin-top","1rem","display","flex","gap","0.5rem","align-items","center","justify-content","center"],["placeholder","paste session id here",2,"min-width","320px","padding","0.5rem","border-radius","6px","border","1px solid #444","background","#111","color","#fff",3,"ngModelChange","ngModel"],[1,"btn","primary",3,"click","disabled"],[2,"margin-top","1rem","text-align","center"],[1,"btn",3,"click"],[1,"failed"],[1,"title","error"]],template:function(e,s){e&1&&(n(0,"div",0),_(1,A,4,0,"div",1)(2,D,11,1,"div",2)(3,W,17,2,"div",3)(4,B,10,0,"div",4),t()),e&2&&(d(),u("ngIf",s.verifying),d(),u("ngIf",s.verified&&!s.verifying),d(),u("ngIf",!s.sessionId&&!s.verifying&&!s.verified),d(),u("ngIf",s.failed&&!s.verifying))},dependencies:[M,I,k,P,O,w],styles:[z,z]})};export{R as Success};
