<div
  class="min-vh-100"
  style="background: linear-gradient(to bottom, var(--bs-body-bg), var(--bs-secondary))"
>
  <app-nav></app-nav>

  <main class="container" style="padding-top: 120px; padding-bottom: 80px">
    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="alert alert-danger" role="alert">
      {{ error }}
    </div>

    <!-- Content section -->
    <div class="row g-4" [class.opacity-50]="loading">
      <!-- Product Images -->
      <div class="col-lg-5">
        <div class="card shadow-lg border">
          <div class="card-body p-3">
            <img
              [src]="book?.image"
              class="img-fluid rounded"
              [alt]="book?.title"
              *ngIf="book?.image; else noImage"
            />
            <ng-template #noImage>
              <div class="text-center p-5 bg-light rounded">
                <i class="bi bi-image fs-1 text-muted"></i>
                <p class="mt-2 mb-0 text-muted">No image available</p>
              </div>
            </ng-template>
          </div>
        </div>
      </div>

      <!-- Product Details -->
      <div class="col-lg-7">
        <div class="card shadow-lg border mb-4">
          <div class="card-body">
            <h1 class="display-5 fw-bold mb-3">{{ book?.title || 'Loading...' }}</h1>
            <p class="fs-4 text-primary mb-2">${{ book?.price || '0' }}</p>
            <p class="fs-5 mb-4">by {{ book?.author || 'Unknown Author' }}</p>

            <div class="mb-4">
              <span class="badge bg-primary me-2">{{ book?.Category || 'Uncategorized' }}</span>
            </div>

            <p class="fs-5 text-muted-custom mb-4">
              {{ book?.description || 'No description available' }}
            </p>

            <div class="d-flex gap-3">
              <button class="btn btn-outline-primary btn-lg" (click)="addToWishlist()">
                Add to Wishlist
              </button>
            </div>
          </div>
        </div>

        <!-- Reviews Section -->
        <div class="card shadow-lg border">
          <div class="card-body">
            <h2 class="h4 fw-bold mb-4">Customer Reviews</h2>

            <!-- Add Review Form -->
            <div class="mb-4" *ngIf="isLoggedIn">
              <div class="card bg-light border-0 mb-3">
                <div class="card-body">
                  <h3 class="h6 fw-semibold mb-3">Write a Review</h3>
                  <div class="mb-3">
                    <label class="form-label">Rating</label>
                    <select [(ngModel)]="newReview.rating" class="form-select">
                      <option value="5">5 Stars</option>
                      <option value="4">4 Stars</option>
                      <option value="3">3 Stars</option>
                      <option value="2">2 Stars</option>
                      <option value="1">1 Star</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Your Review</label>
                    <textarea
                      [(ngModel)]="newReview.comment"
                      class="form-control"
                      rows="3"
                    ></textarea>
                  </div>
                  <button class="btn btn-primary" (click)="submitReview()">Submit Review</button>
                </div>
              </div>
            </div>

            <!-- Loading State for Reviews -->
            <div *ngIf="loading" class="text-center py-3">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Loading reviews...</span>
              </div>
            </div>

            <!-- Reviews List -->
            <div class="d-grid gap-4" *ngIf="!loading && reviews && reviews.length > 0">
              <div *ngFor="let review of reviews" class="card bg-light border-0">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="text-warning">
                      <i
                        *ngFor="let star of [].constructor(review.Rating)"
                        class="bi bi-star-fill me-1"
                      ></i>
                      <i
                        *ngFor="let star of [].constructor(5 - review.Rating)"
                        class="bi bi-star text-muted me-1"
                      ></i>
                    </div>
                  </div>
                  <p class="mb-1">{{ review.Review }}</p>
                  <small class="text-muted">{{ review.CreatedAT | date }}</small>
                </div>
              </div>
            </div>

            <!-- No Reviews Message -->
            <div *ngIf="reviews.length === 0" class="text-center py-4">
              <p class="text-muted mb-0">No reviews yet. Be the first to review this book!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
