<div
  class="min-vh-100"
  style="background: linear-gradient(to bottom, var(--bs-body-bg), var(--bs-secondary))"
>
  <main class="container" style="padding-top: 120px; padding-bottom: 80px">
    <div style="max-width: 1000px; margin: 0 auto">
      <div class="mb-5">
        <h1 class="display-5 fw-bold mb-2">My Account</h1>
        <p class="text-muted-custom">Manage your profile and preferences</p>
      </div>

      <!-- Tabs -->
      <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            [class.active]="activeTab === 'profile'"
            (click)="setActiveTab('profile')"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              class="me-2"
            >
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
            Profile
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            [class.active]="activeTab === 'orders'"
            (click)="setActiveTab('orders')"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              class="me-2"
            >
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
              <circle cx="9" cy="7" r="4" />
              <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
              <path d="M16 3.13a4 4 0 0 1 0 7.75" />
            </svg>
            Orders
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            [class.active]="activeTab === 'settings'"
            (click)="setActiveTab('settings')"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              class="me-2"
            >
              <path
                d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
              />
              <circle cx="12" cy="12" r="3" />
            </svg>
            Settings
          </button>
        </li>
      </ul>

      <!-- Profile Tab -->
      <div *ngIf="activeTab === 'profile'" class="card">
        <div class="card-header">
          <h2 class="h5 mb-0 fw-semibold">Profile Information</h2>
          <p class="text-muted-custom small mb-0">Update your personal details</p>
        </div>
        <div class="card-body">
          <form (ngSubmit)="saveProfile()">
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label class="form-label">Name</label>
                <input type="text" class="form-control" [(ngModel)]="profile.name" name="name" />
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                [(ngModel)]="profile.email"
                name="email"
                readonly
              />
            </div>

            <div class="mb-4">
              <label class="form-label">Role</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="profile.Role"
                name="Role"
                readonly
              />
            </div>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </form>
        </div>
      </div>

      <!-- Orders Tab -->
      <div *ngIf="activeTab === 'orders'" class="card">
        <div class="card-header">
          <h2 class="h5 mb-0 fw-semibold">Order History</h2>
          <p class="text-muted-custom small mb-0">View your past orders</p>
        </div>
        <div class="card-body">
          <div class="d-grid gap-3">
            <div *ngFor="let order of orders" class="border rounded p-3 hover-shadow">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <div>
                  <p class="fw-semibold mb-1">Order #{{ order.number }}</p>
                  <p class="small text-muted-custom mb-0">Placed on {{ order.date }}</p>
                </div>
                <span class="badge bg-primary-subtle text-primary-emphasis">{{
                  order.status
                }}</span>
              </div>
              <p class="small mb-3">{{ order.items }} items • ${{ order.total }}</p>
              <button class="btn btn-outline-secondary btn-sm">View Details</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div *ngIf="activeTab === 'settings'" class="card">
        <div class="card-header">
          <h2 class="h5 mb-0 fw-semibold">Account Settings</h2>
          <p class="text-muted-custom small mb-0">Manage your account preferences</p>
        </div>
        <div class="card-body">
          <div>
            <h3 class="h6 fw-semibold mb-3">Security</h3>
            <div class="d-grid gap-2">
              <button
                type="button"
                class="btn btn-outline-secondary text-start"
                (click)="openModal()"
              >
                Change Password
              </button>

              <button
                type="button"
                class="btn btn-outline-secondary text-start"
                (click)="openTwoFactorModal()"
              >
                Two-Factor Authentication
              </button>
              <button class="btn btn-outline-danger text-start" (click)="openDeleteModal()">
                Delete Account
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Change Password</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="changePassword()">
          <div class="mb-3">
            <label for="currentPassword" class="form-label">Current Password</label>
            <input
              type="password"
              class="form-control"
              id="currentPassword"
              [(ngModel)]="currentPassword"
              name="currentPassword"
              required
            />
          </div>
          <div class="mb-3">
            <label for="newPassword" class="form-label">New Password</label>
            <input
              type="password"
              class="form-control"
              id="newPassword"
              [(ngModel)]="newPassword"
              name="newPassword"
              required
            />
          </div>
          <div class="mb-3">
            <label for="confirmPassword" class="form-label">Confirm New Password</label>
            <input
              type="password"
              class="form-control"
              id="confirmPassword"
              [(ngModel)]="confirmPassword"
              name="confirmPassword"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">Change Password</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="passwordToast" class="toast align-items-center text-bg-success border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body">Password changed successfully!</div>
      <button
        type="button"
        class="btn-close btn-close-white me-2 m-auto"
        data-bs-dismiss="toast"
      ></button>
    </div>
  </div>
</div>

<!-- 2FA Modal -->
<div class="modal fade" id="twoFactorModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Two-Factor Authentication</h5>
        <button type="button" class="btn-close" (click)="closeTwoFactorModal()"></button>
      </div>
      <div class="modal-body">
        <p class="mb-3">
          Add an extra layer of security to your account. When enabled, you’ll be asked for a
          verification code in addition to your password when signing in.
        </p>

        <div *ngIf="!isTwoFactorEnabled; else disable2fa">
          <form (ngSubmit)="enableTwoFactor()">
            <div class="mb-3">
              <label for="phoneNumber" class="form-label">Phone Number</label>
              <input
                type="tel"
                id="phoneNumber"
                class="form-control"
                [(ngModel)]="twoFactorPhone"
                name="phoneNumber"
                placeholder="+20 1023323888"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary w-100">Enable 2FA</button>
          </form>
        </div>

        <ng-template #disable2fa>
          <div class="text-center">
            <p class="fw-semibold mb-3 text-success">
              Two-Factor Authentication is currently <strong>enabled</strong>.
            </p>
            <button class="btn btn-outline-danger w-100" (click)="disableTwoFactor()">
              Disable 2FA
            </button>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-danger">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">Delete Account</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          (click)="closeDeleteModal()"
        ></button>
      </div>
      <div class="modal-body">
        <p class="mb-3">
          ⚠️ Are you absolutely sure you want to <strong>delete your account</strong>? This action
          <strong>cannot be undone</strong>.
        </p>
        <div class="form-check mb-3">
          <input
            type="checkbox"
            id="confirmDelete"
            class="form-check-input"
            [(ngModel)]="confirmDelete"
          />
          <label for="confirmDelete" class="form-check-label">
            I understand the consequences.
          </label>
        </div>
        <div class="d-flex justify-content-end gap-2">
          <button class="btn btn-outline-secondary" (click)="closeDeleteModal()">Cancel</button>
          <button class="btn btn-danger" [disabled]="!confirmDelete" (click)="deleteAccount()">
            Delete Account
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
